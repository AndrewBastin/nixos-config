# DWM Source Modifications

This document tracks all modifications made to the dwm source code for patch resolution and maintenance purposes.

## Base Version
- **dwm version**: 6.4 (latest from git.suckless.org/dwm)
- **Last updated**: 2025-08-04

## Applied Patches

### 1. noborder patch
- **Source**: https://dwm.suckless.org/patches/noborder/
- **Purpose**: Removes borders when there is only one window visible
- **Files modified**: `dwm.c` (resizeclient function, lines 1295-1303)
- **Implementation**: Added logic to remove borders when only one tiled window or in monocle layout
- **Status**: ✅ Applied

### 2. colorbar patch  
- **Source**: https://dwm.suckless.org/patches/colorbar/
- **Purpose**: Adds support for colored status bar text with granular color control
- **Files modified**: `dwm.c` (enum and drawbar function), `config.h` (via Nix module)
- **Implementation**: 
  - Extended color scheme enum (line 61): `SchemeStatus, SchemeTagsSel, SchemeTagsNorm, SchemeInfoSel, SchemeInfoNorm`
  - Modified drawbar function (lines 712, 730, 740, 746) to use new color schemes
- **Status**: ✅ Applied

## Custom Modifications

### 3. Hide empty tags in status bar
- **Purpose**: Only show tags/workspaces that have clients attached or are currently selected
- **Files modified**: `dwm.c` (drawbar function, lines 724-726)
- **Implementation**: Added condition `if (!(occ & 1 << i) && !(m->tagset[m->seltags] & 1 << i)) continue;`
- **Status**: ✅ Applied

### 4. Right-align focused client title
- **Purpose**: Display focused window title right-aligned in status bar
- **Files modified**: `dwm.c` (drawbar function, lines 747-750)
- **Implementation**: 
  - Calculate title width: `int title_w = TEXTW(m->sel->name);`
  - Position from right: `drw_text(drw, x + w - title_w, 0, title_w, bh, lrpad / 2, m->sel->name, 0);`
  - Adjust floating indicator position
- **Status**: ✅ Applied

### 5. Remove dwm version text
- **Purpose**: Remove "dwm-6.x" text from bottom right corner when no status is set
- **Files modified**: `dwm.c` (updatestatus function, lines 2029-2031)
- **Implementation**: Changed `strcpy(stext, "dwm-"VERSION);` to `strcpy(stext, "");`
- **Status**: ✅ Applied

### 6. Full status bar redraw fix
- **Purpose**: Prevent status bar artifacts and ensure complete redraw on updates
- **Files modified**: `dwm.c` (drawbar function, lines 709-711)
- **Implementation**: Added `drw_rect(drw, 0, 0, m->ww, bh, 1, 1);` to clear entire bar background before drawing
- **Status**: ✅ Applied

## File Structure
```
dwm-source/
├── config.def.h    # Default configuration (not used, overridden by Nix)
├── config.h        # Generated by Nix module
├── dwm.c          # Main dwm source (patched)
├── dwm.1          # Manual page
├── Makefile       # Build configuration
└── ...            # Other source files
```

## Build Notes
- Configuration is dynamically generated by the Nix module in `default.nix`
- The `config.h` file is overwritten during build process
- All patches are applied directly to source files, not via Nix patch system

## Maintenance
When updating dwm version:
1. Check if patches are still compatible
2. Re-apply patches if needed
3. Update this documentation
4. Test build and functionality

## Patch Application Log
- 2025-08-04: Initial setup with noborder and colorbar patches
- 2025-08-04: Added custom modifications for tag visibility, title alignment, and version text removal